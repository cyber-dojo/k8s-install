
version: 2.1
jobs:
  build:
    machine:
      image: 'ubuntu-1604:201903-01'
    environment:
      HELM_VERSION: v2.16.0

    steps:
        - checkout

        - run:
            name: Setup k3s
            command: |
              cd build_scripts
              sudo ./install_k3s.sh
              echo "Installed k3s"

        - run:
            name: Setup helm
            command: |
              cd build_scripts
              sudo ./install_helm.sh ${HELM_VERSION}
              echo "Installed helm"

        - run:
            name: Deploy cyber-dojo
            command: |
              cd build_scripts
              sudo ./deploy_cyber_dojo.sh
              echo "Deployed cyber-dojo"
