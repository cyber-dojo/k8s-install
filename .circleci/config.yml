
version: 2.1
jobs:
  build:
    machine:
      image: 'ubuntu-1604:201903-01'
    environment:
      HELM_VERSION: v2.16.0

    steps:
        - checkout

        - run:
            name: Setup k3s
            command: |
              cd build_scripts
              sudo ./install_k3s.sh
              echo "Installed k3s"

        - run:
            name: Setup Helm
            command: |
              cd build_scripts
              sudo ./install_helm.sh ${HELM_VERSION}
              echo "Installed Helm"

        - run:
            name: Deploy cyberdojo
            command: |
              cd build_scripts
              sudo ./deploy.sh
              echo "Deploying cyberdojo complete"
